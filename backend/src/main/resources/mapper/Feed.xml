<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
   "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
   
<mapper namespace="com.web.curation.model.dao.FeedDao">

   <select id="getRecipeContents" parameterType="String" resultType="RecipeSingleContent">
      select * from recipe_content where recipe_idx = #{recipe_idx}
   </select>
   
   <select id="getLatestFeed" parameterType="String" resultType="RecipeContent">
      select r.idx, r.title, r.regdate, r.id, c.img , r.nickname
      from recipe as r join recipe_content as c
      on r.idx=c.recipe_idx
      where c.thumbnail="true" and (r.id in (select following from follow where follower=#{id})or id=#{id})
   </select>
   
   <select id="getAllRecipes" parameterType="String" resultType="RecipeContent">
      select * from recipe where id = #{id}
   </select>

   <!-- title, id -->
   <insert id="writeRecipeInfo" parameterType="RecipeInfo">
      insert into recipe(title,id,nickname) values(#{title},#{id},#{nickname})
   </insert>
   
   <select id="getRecipe_idx" parameterType="Map" resultType="integer">
      select idx from recipe where id=#{id} and title = #{title} order by regdate desc limit 1
   </select>
   
   <!-- img, des, thumbnail, recipe_idx -->
   <insert id="writeRecipeContent" parameterType="SaveRecipeContent">
      insert into recipe_content(img, des, thumbnail, recipe_idx, content_order)
      values(#{img}, #{des}, #{thumbnail}, #{recipe_idx}, #{content_order})
   </insert>
   
   <select id="getThumbnail" parameterType="integer" resultType="String">
      select img from recipe_content where thumbnail="true" and recipe_idx=#{reicpe_idx}
   </select>
   
   <insert id="writeComment" parameterType="SaveComment">
   		insert into recipe_comment(comment, content_idx, id) values(#{comment}, #{content_idx}, #{id})
   </insert>
</mapper>